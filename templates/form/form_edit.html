{% extends "/security/base.html" %}
{% block title %}Forms{% endblock %}
{% block main_title %}Edit Form{% endblock %}

{% block content %}
    <!--Header Page-->
    <div class="container">
        <h1>Welcome {{user.name}}</h1>
        <h4>This is the form: <b>{{form.name}}</b>. </h4>
        <h6>{{form.description}}</h6>
        <a href="/form/{{form.id}}/editMainInfo">
            <button type="button" class="btn btn-green">EDIT FORM INFO</button>
        </a><br><br>
        <h4>Here the questions:</h4>
    </div>

    <div class="container">
        <!--For all the question in the form:
                                    -element in ol: name question + EDIT + DELETE
                                    -if current question is sinlge/multiple:
                                            -sublist ul in wich each element is a possible answers
            At the end: ADD QUESTION-->
        <ol>
        {% for q, m in questions %}
            <li>
                <form action="" name="delete_form">
                    <label>{{q.text}}</label>&nbsp;&nbsp;&nbsp;
                    <a href="/form/{{form.id}}/{{q.id}}">
                        <button type="button" class="btn btn-green">EDIT QUESTION</button>
                    </a>&nbsp;&nbsp;
                    <!-- Hidden form to send the id question when clicking on DELETE-->
                    <input type="hidden" name="question" value="{{q.id}}">
                    <input type="submit" value="DELETE" name="delete_button" class="btn btn-danger">
                </form>
                {% if q.open %}
                    {%for tmp in q.open%}
                        <br><br>
                        <form id="allows_file_form" method="POST" action="/form/{{form.id}}/{{q.id}}/flag">
                            <label>Allows file </label>
                            <select class="form-select" name="checkBox_file" onchange="document.getElementById('allows_file_form').submit()">
                                <option {%if tmp.has_file%} selected {%endif%} value="yes">Yes</option>
                                <option {%if not tmp.has_file%} selected {%endif%} value="no">No</option>
                            </select>
                        </form>
                    {%endfor%}
                {%endif%}
            </li>
            {% if q.single %}
                <br>
                {% for q1 in q.single%}
                    <ul>
                    {% for a in q1.possible_answers%}
                        <li >{{a.content}}</li>
                    {% endfor %}
                    </ul><br>
                {% endfor %}

            {% elif q.multiple_choice %}
                <br>
                {% for q1 in q.multiple_choice%}
                    <ul type="square">
                    {% for a in q1.possible_answers%}
                        <li >{{a.content}}</li>
                    {% endfor %}
                    </ul><br>
                {% endfor %}
            {% endif %}
            <form id="mandatory_form" method="POST" action="/form/{{form.id}}/{{q.id}}/flag">
                    <label>Mandatory </label>
                    <select name="checkBox_mandatory" onchange="document.getElementById('mandatory_form').submit()">
                        <option {%if m.mandatory%} selected {%endif%} value="yes">Yes</option>
                        <option {%if not m.mandatory%} selected {%endif%} value="no">No</option>
                    </select>
            </form>

            <br><br>
        {% endfor %}
        </ol>

        <a href="/form/{{form.id}}/add_question"><button type="button" class="btn btn-primary">ADD QUESTION</button></a>

        <br><br><br><br>
    </div>

    <!-- TODO Togliere
    <script>
        function set_allows_file_js(elem, q_id){
            if (elem.checked) {
                console.log(q_id + " " + elem.checked)
                //location.reload()
            } else {
                console.log(q_id + " " + elem.checked)
                //location.reload()
            }
        }
    </script>-->
{% endblock %}