{% extends "/security/base.html" %}
{% block title %}Form Create{% endblock %}
{% block main_title %}Form Creation{% endblock %}

{% block content %}
    <div class="container">
        <div class="form-group">
            <div class="input-group">
                <form method="POST" name="create_form">
                    <div class="form-group">
                        <!--INTERACTIVE FORM:
                            Import-> name-> description-> list of templates->Submit
                            Not Import-> name-> description-> Sumbit
                            -->

                        <h3>Would you like to import a form template?</h3>
                        <select name="import" onChange="import_template(this)">
                            <option value="" selected> </option>
                            <option value="si">Yes</option>
                            <option value="no">No</option>
                        </select>

                        <br>

                        <span id="name"></span>

                        <span id="template list"></span>

                        <span id="mostra form"></span>

                        <span id="submit"></span>

                    </div>

                </form>
                <script type='text/javascript'>

                    let name = false; /*sia name che descprition devono essere inseriti per far apparire submit*/
                    let desc = false;
                    let temp = false;

                    function import_template(imp) {
                        const v_imp = imp.value;

                        const box = document.getElementById('name');
                        const box2 = document.getElementById('template list');
                        const box3 = document.getElementById('mostra form');
                        const box4 = document.getElementById('submit');

                        box.innerHTML = '';
                        box2.innerHTML = '';
                        box3.innerHTML = '';
                        box4.innerHTML = '';

                        name = false;
                        desc = false;
                        temp = true;

                        if (v_imp === "si") {
                            temp = false;
                            /*Name + Description input text*/
                            box.innerHTML = '<label>Form Name</label><br>\n' +
                                '            <input type="text" name="name" class="form-control" onkeyup="check_uno(this)"><br><br>' +
                                '            <label>Descrizione Form</label><br>\n' +
                                '            <input type="text" name="description" class="form-control" onkeyup="check_due(this)"><br><br>';

                            /*Menu with template possible*/
                            box2.innerHTML = '<label>Template Name</label><br>\n'+
                                             '<select name="template" onChange="mostra_form(this); submit_f(this)">\n' +
                                '                                <option value="" selected> </option>\n' +
                                '                                <option value="party">Party</option>\n' +
                                '                                <option value="events">Event</option>\n' +
                                '                                <option value="info">General Info</option>\n' +
                                '                                <option value="meeting">Meeting</option>\n' +
                                '                            </select>'
                        } else if(v_imp === "no") {
                            /*Name + Description input text*/
                            box.innerHTML = '<label>Form Name</label><br>\n' +
                                '            <input type="text" name="name" class="form-control" onkeyup="check_uno(this)"><br><br>' +
                                '            <label>Form Description</label><br>\n' +
                                '            <input type="text" name="description" class="form-control" onkeyup="check_due(this)"><br><br>';
                        }
                    }

                    function mostra_form(v) {
                        const box = document.getElementById('mostra form');
                        const value = v.value;

                        /*For every type of the template show a preview: see form_edit for the HTML code to do this*/
                        if(value === "party")
                        {
                            box.innerHTML = '<div class="container">\n' +
                                '        <p><b>Template Questions Peview:</b></p>\n'+
                                '        <ol>\n' +
                                '        {% for f in forms %}\n' +
                                '        {% if f.id == 1 %}\n' +
                                '        {% for q in f.questions %}\n' +
                                '            <li>{{q.text}}</li>\n' +
                                '            {% if q.single %}\n' +
                                '                {% for q1 in q.single%}\n' +
                                '                    <ul>\n' +
                                '                    {% for a in q1.possible_answers%}\n' +
                                '                        <li >{{a.content}}</li>\n' +
                                '                    {% endfor %}\n' +
                                '                    </ul>\n' +
                                '                {% endfor %}\n' +
                                '            {% elif q.multiple_choice %}\n' +
                                '                {% for q1 in q.multiple_choice%}\n' +
                                '                    <ul type="square">\n' +
                                '                    {% for a in q1.possible_answers%}\n' +
                                '                        <li >{{a.content}}</li>\n' +
                                '                    {% endfor %}\n' +
                                '                    </ul>\n' +
                                '                {% endfor %}\n' +
                                '            {% endif %}\n' +
                                '        {% endfor %}\n' +
                                '        {% endif %}\n' +
                                '        {% endfor %}\n' +
                                '        </ol>' +
                                '</div>'
                        }
                        else if(value === "events")
                        {
                            box.innerHTML = '<div class="container">\n' +
                                '        <p><b>Template Questions Peview:</b></p>\n'+
                                '        <ol>\n' +
                                '        {% for f in forms %}\n' +
                                '        {% if f.id == 3 %}\n' +
                                '        {% for q in f.questions %}\n' +
                                '            <li>{{q.text}}</li>\n' +
                                '            {% if q.single %}\n' +
                                '                {% for q1 in q.single%}\n' +
                                '                    <ul>\n' +
                                '                    {% for a in q1.possible_answers%}\n' +
                                '                        <li >{{a.content}}</li>\n' +
                                '                    {% endfor %}\n' +
                                '                    </ul>\n' +
                                '                {% endfor %}\n' +
                                '            {% elif q.multiple_choice %}\n' +
                                '                {% for q1 in q.multiple_choice%}\n' +
                                '                    <ul type="square">\n' +
                                '                    {% for a in q1.possible_answers%}\n' +
                                '                        <li >{{a.content}}</li>\n' +
                                '                    {% endfor %}\n' +
                                '                    </ul>\n' +
                                '                {% endfor %}\n' +
                                '            {% endif %}\n' +
                                '        {% endfor %}\n' +
                                '        {% endif %}\n' +
                                '        {% endfor %}\n' +
                                '        </ol>' +
                                '</div>'
                        }
                        else if(value === "info")
                        {
                            box.innerHTML = '<div class="container">\n' +
                                '        <p><b>Template Questions Peview:</b></p>\n'+
                                '        <ol>\n' +
                                '        {% for f in forms %}\n' +
                                '        {% if f.id == 4 %}\n' +
                                '        {% for q in f.questions %}\n' +
                                '            <li>{{q.text}}</li>\n' +
                                '            {% if q.single %}\n' +
                                '                {% for q1 in q.single%}\n' +
                                '                    <ul>\n' +
                                '                    {% for a in q1.possible_answers%}\n' +
                                '                        <li >{{a.content}}</li>\n' +
                                '                    {% endfor %}\n' +
                                '                    </ul>\n' +
                                '                {% endfor %}\n' +
                                '            {% elif q.multiple_choice %}\n' +
                                '                {% for q1 in q.multiple_choice%}\n' +
                                '                    <ul type="square">\n' +
                                '                    {% for a in q1.possible_answers%}\n' +
                                '                        <li >{{a.content}}</li>\n' +
                                '                    {% endfor %}\n' +
                                '                    </ul>\n' +
                                '                {% endfor %}\n' +
                                '            {% endif %}\n' +
                                '        {% endfor %}\n' +
                                '        {% endif %}\n' +
                                '        {% endfor %}\n' +
                                '        </ol>' +
                                '</div>'
                        }
                        else if(value === "meeting")
                        {
                            box.innerHTML = '<div class="container">\n' +
                                '        <p><b>Template Questions Peview:</b></p>\n'+
                                '        <ol>\n' +
                                '        {% for f in forms %}\n' +
                                '        {% if f.id == 2 %}\n' +
                                '        {% for q in f.questions %}\n' +
                                '            <li>{{q.text}}</li>\n' +
                                '            {% if q.single %}\n' +
                                '                {% for q1 in q.single%}\n' +
                                '                    <ul>\n' +
                                '                    {% for a in q1.possible_answers%}\n' +
                                '                        <li >{{a.content}}</li>\n' +
                                '                    {% endfor %}\n' +
                                '                    </ul>\n' +
                                '                {% endfor %}\n' +
                                '            {% elif q.multiple_choice %}\n' +
                                '                {% for q1 in q.multiple_choice%}\n' +
                                '                    <ul type="square">\n' +
                                '                    {% for a in q1.possible_answers%}\n' +
                                '                        <li >{{a.content}}</li>\n' +
                                '                    {% endfor %}\n' +
                                '                    </ul>\n' +
                                '                {% endfor %}\n' +
                                '            {% endif %}\n' +
                                '        {% endfor %}\n' +
                                '        {% endif %}\n' +
                                '        {% endfor %}\n' +
                                '        </ol>' +
                                '</div>'
                        }
                        else if(value === "")
                        {
                            box.innerHTML='';
                        }
                    }

                    /*show the submit button if a template is choose and the name and desc is not balnk*/
                    function submit_f(v) {
                        const box = document.getElementById('submit');
                        const value = v.value;
                        if(value !== "" && name && desc) {
                            temp = true
                            box.innerHTML = '<input type="submit" value="Submit" class="btn btn-primary"><br><br>';
                        }
                        else {
                            box.innerHTML = '';
                            temp = false
                        }
                    }

                    /*controlla che il nome inserito sia corretto*/
                    function check_uno(text) {
                        const box = document.getElementById('submit');
                        const value = text.value;
                        if(value === "") {
                            name = false
                            box.innerHTML = '';
                        }
                        else {
                            name = true
                            if(desc && temp)
                                box.innerHTML = '<input type="submit" value="Submit" class="btn btn-primary"><br><br>';
                        }
                    }

                    /*controlla che la descrizione inserita sia corretta*/
                    function check_due(text) {
                        const box = document.getElementById('submit');
                        const value = text.value;
                        if(value === "") {
                            desc = false
                            box.innerHTML = '';
                        }
                        else {
                            desc = true
                            if(name && temp)
                                box.innerHTML = '<input type="submit" value="Submit" class="btn btn-primary"><br><br>';
                        }
                    }
                </script>

                <br><br><br><br>
            </div>
        </div>
    </div>
{% endblock %}